######################
## SGE Installation ##
######################


Setup:

Two servers; one master and one client (Ubuntu)
Master(FQDN): ajen_m.domain.com ajen_m, 10.9.8.7
client(FQDN): ajen_c.domain.com ajen_c, 10.1.2.3


Install prerequisites for SGE

- switch to admin user
>. sudo su

- update sourcelist
>. apt-get update 

- Edit /ect/hosts file. Ensure that, at minimum, there is an entry in the hosts file of the master for each exec node, and in the hosts file of the exec nodes there 
  should be an entry for the master
	
	For exmaple,

	1. /etc/hosts on ajen_m
	127.0.0.1       localhost
	#127.0.0.1      localhost.localdomain   localhost
	10.9.8.7   		ajen_m.domain.com 		ajen_m
	10.1.2.3   		ajen_c.domain.com       ajen_c

	2. /etc/hosts on ajen_c
	127.0.0.1       localhost
	#127.0.0.1      localhost.localdomain   localhost
	10.1.2.3   		ajen_c.domain.com 		ajen_c
	10.9.8.7   		ajen_m.domain.com 		ajen_m


-  Install Java on ajen_m and ajen_c
>. apt-get install openjdk-6-jre




Install SGE 


- Install SGE on ajen_m (master node)
>. apt-get install gridengine-client gridengine-qmon gridengine-exec gridengine-master
** If you get prompted with auto configuration, you can select yes. You will see the following messge. Just input according to the setup above **
###################################################################################################################
## Configure SGE automatically? yes  																			 ##
## SGE cell name: default            																			 ##
## SGE master hostname: ajen_m (this should be the fully qualified domain name of the SGE master, not localhost) ##
###################################################################################################################
** Skip the following if the above prompts for you **

	# It might throw error message saying that there is a communication error. For example,
	  "critical error: abort qmaster registration due to communication errors
	   daemonize error: child exited before sending daemonize state"
	# No worries, it might cause by java or previous left-over installation. Check the process,
	>. ps aux | grep sge

	# The above is to see if gridengine-exec is started or not. If there is only gridengine-master, then start gridengine-exec then restart the gridengine-master
	>. /etc/init.d/gridengine-exec start
	>. /etc/init.d/gridengine-master restart

	#. However, if there already exists gridengine-exec, then kill it, then start it again.
	>. kill -9 "ID"
	>. /etc/init.d/gridengine-exec start
	>. /etc/init.d/gridengine-master restart

	#. Then check the process again
	>. ps aux | grep sge

	# Make sure those two processes are up and running.


- Install SGE on ajen_c (compute node)
>. apt-get install gridengine-client gridengine-exec
** If you get prompted with auto configuration, you can select yes. You will see the following messge. Just input according to the setup above **
###################################################################################################################
## Configure SGE automatically? Yes      																		 ## 
## SGE cell name: default																						 ## 	
## SGE master hostname: ajen_m (this should be the fully qualified domain name of the SGE master, not localhost) ##
###################################################################################################################
** Skip the following if the above prompts for you **

	# An communication error similar to the one above might be thrown again. Thus, gridengine-exec fails to start. This time we will need to manually modify act_qmaster 
	# file, so the compute node knows which the master node is.
	>. echo ajen_m.domain.com > /var/lib/gridengine/default/common/act_qmaster

	# If you use qhost on Compute node, it will prompt error messages saying "ajen02" (my Compute node) is not in the access list. This is the indication that the 
	# internal communication has been successfully established.

	# Right now we just need to go back to Master node to configure access list, users, groups, and etc.


- Log back to ajen_m
# Configure master node
** Definition can be found at - cat /usr/share/doc/gridengine-common/README.Debian

>. sudo su
>. sudo -u sgeadmin qconf -am FJen                     # FJen is my local user on master node. It is suggested that you add yourself as a manager and perform the rest of
													   # these tasks as your own user      
>. exit
>. qconf -au FJen users                                # and to a userlist
>. qconf -as ajen01                                    # Add a submission host
>. qconf -ahgrp @allhosts                              # just save the file without modifying it
>. qconf -aattr hostgroup hostlist ajen01 @allhosts    # Add the exec host to the @allhosts list
>. qconf -aq main.q                                    # just save the file without modifying it
>. qconf -aattr queue hostlist @allhosts main.q        # Add the host group to the queue
>. qconf -aattr queue slots "4, [ajen_m=3]" main.q     # 4 by default for all nodes (this depends on your server spec. If your server has 8 cores, then you can replace 4 
													     with 8 and minus 1 for the master server), 3 specifically for ajen_m, which leaves 1 of the 4 cpus free for the 
													     master process

# Configure compute node
>. qconf -as ajen_c                                    # Add a submission host
>. qconf -ae                                           # Add an execution host. Change the hostname entry to ajen02
>. qconf -aattr hostgroup hostlist ajen_c @allhosts


- Log back to ajen_c
# Start grindengine_exec on ajen_c
>. /etc/init.d/gridengine.exec start
** if the above function cannot be found, try
>. service gridengine.exec start
** sometimes services will be converted to upper stream. 


- Software Checks
1. On master, run >. ps aux | grep sge.
   You should see two entries: 
   I). sgeadmin  6890  0.0  0.3  54044  2112 ?        Sl   15:02   0:00 /usr/lib/gridengine/sge_execd
   II). sgeadmin  6947  0.0  0.9 138220  5720 ?        Sl   15:02   0:00 /usr/lib/gridengine/sge_qmaster

2. On compute, run >. ps aux | grep sge.
   You should see one entry
   I). sgeadmin  6758  0.0  0.3  54044  2048 ?        Sl   15:13   0:00 /usr/lib/gridengine/sge_execd


